/*! @viselect/vue 3.0.0-beta.7 MIT | https://github.com/Simonwep/selection */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SelectionArea={},t.vue)}(this,(function(t,e){"use strict";const s=(t,e="px")=>"number"==typeof t?t+e:t;function i({style:t},e,i){if("object"==typeof e)for(const[i,o]of Object.entries(e))t[i]=s(o);else void 0!==i&&(t[e]=s(i))}function o(t){return(e,s,i,o={})=>{e instanceof HTMLCollection||e instanceof NodeList?e=Array.from(e):Array.isArray(e)||(e=[e]),Array.isArray(s)||(s=[s]);for(const n of e)for(const e of s)n[t](e,i,{capture:!1,...o});return[e,s,i,o]}}const n=o("addEventListener"),r=o("removeEventListener"),h=t=>{const e=t.touches&&t.touches[0]||t;return{tap:e,x:e.clientX,y:e.clientY,target:e.target}};function c(t){let e=t.path||t.composedPath&&t.composedPath();if(e)return e;let s=t.target.parentElement;for(e=[t.target,s];s=s.parentElement;)e.push(s);return e.push(document,window),e}function l(t,e,s="touch"){switch(s){case"center":{const s=e.left+e.width/2,i=e.top+e.height/2;return s>=t.left&&s<=t.right&&i>=t.top&&i<=t.bottom}case"cover":return e.left>=t.left&&e.top>=t.top&&e.right<=t.right&&e.bottom<=t.bottom;case"touch":return t.right>=e.left&&t.left<=e.right&&t.bottom>=e.top&&t.top<=e.bottom;default:throw new Error(`Unkown intersection mode: ${s}`)}}function a(t,e){const s=t.indexOf(e);~s&&t.splice(s,1)}function u(t,e=document){const s=Array.isArray(t)?t:[t],i=[];for(let t=0,o=s.length;t<o;t++){const o=s[t];"string"==typeof o?i.push(...Array.from(e.querySelectorAll(o))):o instanceof HTMLElement&&i.push(o)}return i}const d=()=>window.matchMedia("(hover: none), (pointer: coarse)").matches,f=(t,e)=>{for(const[s,i]of Object.entries(t)){const o=e[s];t[s]=void 0===o?t[s]:"object"!=typeof o||"object"!=typeof i||null===i||Array.isArray(i)?o:f(i,o)}return t},{abs:p,max:v,min:m,ceil:y}=Math;class SelectionArea extends class{constructor(){this.t=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(t,e){const s=this.t.get(t)||new Set;return this.t.set(t,s),s.add(e),this}removeEventListener(t,e){return this.t.get(t)?.delete(e),this}dispatchEvent(t,...e){let s=!0;for(const i of this.t.get(t)||[])s=!1!==i(...e)&&s;return s}unbindAllListeners(){this.t.clear()}}{constructor(t){super(),this.i={touched:[],stored:[],selected:[],changed:{added:[],removed:[]}},this.o=[],this.h=new DOMRect,this.l={y1:0,x2:0,y2:0,x1:0},this.u=!0,this.p=!0,this.v={x:0,y:0},this.m={x:0,y:0},this.disable=this.g.bind(this,!1),this.enable=this.g,this._=f({selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,behaviour:{overlap:"invert",intersect:"touch",startThreshold:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750}},features:{range:!0,touch:!0,singleTap:{allow:!0,intersect:"native"}},startAreas:["html"],boundaries:["html"],container:"body"},t);for(const t of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))"function"==typeof this[t]&&(this[t]=this[t].bind(this));const{document:e,selectionAreaClass:s,selectionContainerClass:o}=this._;this.S=e.createElement("div"),this.A=e.createElement("div"),this.A.appendChild(this.S),this.S.classList.add(s),o&&this.A.classList.add(o),i(this.S,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),i(this.A,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this.enable()}g(t=!0){const{document:e,features:s}=this._,i=t?n:r;i(e,"mousedown",this.T),s.touch&&i(e,"touchstart",this.T,{passive:!1})}T(t,e=!1){const{x:s,y:i,target:o}=h(t),{_:r}=this,{document:a}=this._,d=o.getBoundingClientRect(),f=u(r.startAreas,r.document),p=u(r.boundaries,r.document);this.L=p.find((t=>l(t.getBoundingClientRect(),d)));const v=c(t);if(!this.L||!f.find((t=>v.includes(t)))||!p.find((t=>v.includes(t))))return;if(!e&&!1===this.j("beforestart",t))return;this.l={x1:s,y1:i,x2:0,y2:0};const m=a.scrollingElement||a.body;this.m={x:m.scrollLeft,y:m.scrollTop},this.u=!0,this.clearSelection(!1),n(a,["touchmove","mousemove"],this.M,{passive:!1}),n(a,["mouseup","touchcancel","touchend"],this.C),n(a,"scroll",this.k)}O(t){const{singleTap:{intersect:e},range:s}=this._.features,i=h(t);let o=null;if("native"===e)o=i.target;else if("touch"===e){this.resolveSelectables();const{x:t,y:e}=i;o=this.o.find((s=>{const{right:i,left:o,top:n,bottom:r}=s.getBoundingClientRect();return t<i&&t>o&&e<r&&e>n}))}if(!o)return;for(this.resolveSelectables();!this.o.includes(o);){if(!o.parentElement)return;o=o.parentElement}const{stored:n}=this.i;if(this.j("start",t),t.shiftKey&&n.length&&s){const t=n[0],[e,s]=4&t.compareDocumentPosition(o)?[o,t]:[t,o],i=[...this.o.filter((t=>4&t.compareDocumentPosition(e)&&2&t.compareDocumentPosition(s))),o,e,s];this.select(i)}else n.includes(o)&&(1===n.length||t.ctrlKey)?this.deselect(o):this.select(o);this.j("stop",t)}M(t){const{container:e,document:s,features:o,behaviour:{startThreshold:c}}=this._,{x1:l,y1:a}=this.l,{x:f,y:v}=h(t),m=typeof c;("number"===m&&p(f+v-(l+a))>=c||"object"===m&&p(f-l)>=c.x||p(v-a)>=c.y)&&(r(s,["mousemove","touchmove"],this.M,{passive:!1}),n(s,["mousemove","touchmove"],this.F,{passive:!1}),i(this.S,"display","block"),u(e,s)[0].appendChild(this.A),this.resolveSelectables(),this.u=!1,this.R=this.L.getBoundingClientRect(),this.p=this.L.scrollHeight!==this.L.clientHeight||this.L.scrollWidth!==this.L.clientWidth,this.p&&(n(s,"wheel",this.$,{passive:!1}),this.o=this.o.filter((t=>this.L.contains(t)))),this.D(),this.j("start",t),this.F(t)),o.touch&&d()&&t.preventDefault()}D(){const{A:t,L:e,S:s}=this,o=this.R=e.getBoundingClientRect();this.p?(i(t,{top:o.top,left:o.left,width:o.width,height:o.height}),i(s,{marginTop:-o.top,marginLeft:-o.left})):(i(t,{top:0,left:0,width:"100%",height:"100%"}),i(s,{marginTop:0,marginLeft:0}))}F(t){const{x:e,y:s}=h(t),{v:i,l:o,_:n}=this,{features:r}=n,{speedDivider:c}=n.behaviour.scrolling,l=this.L;if(o.x2=e,o.y2=s,this.p&&(i.y||i.x)){const e=()=>{if(!i.x&&!i.y)return;const{scrollTop:s,scrollLeft:n}=l;i.y&&(l.scrollTop+=y(i.y/c),o.y1-=l.scrollTop-s),i.x&&(l.scrollLeft+=y(i.x/c),o.x1-=l.scrollLeft-n),this.H(),this.q(),this.j("move",t),this.B(),requestAnimationFrame(e)};requestAnimationFrame(e)}else this.H(),this.q(),this.j("move",t),this.B();r.touch&&d()&&t.preventDefault()}k(){const{m:t,_:{document:e}}=this,{scrollTop:s,scrollLeft:i}=e.scrollingElement||e.body;this.l.x1+=t.x-i,this.l.y1+=t.y-s,t.x=i,t.y=s,this.D(),this.H(),this.q(),this.j("move",null),this.B()}$(t){const{manualSpeed:e}=this._.behaviour.scrolling,s=t.deltaY?t.deltaY>0?1:-1:0,i=t.deltaX?t.deltaX>0?1:-1:0;this.v.y+=s*e,this.v.x+=i*e,this.F(t),t.preventDefault()}H(){const{v:t,l:e,h:s,L:i,R:o}=this,{scrollTop:n,scrollHeight:r,clientHeight:h,scrollLeft:c,scrollWidth:l,clientWidth:a}=i,u=o,{x1:d,y1:f}=e;let{x2:y,y2:g}=e;y<u.left?(t.x=c?-p(u.left-y):0,y=u.left):y>u.right?(t.x=l-c-a?p(u.left+u.width-y):0,y=u.right):t.x=0,g<u.top?(t.y=n?-p(u.top-g):0,g=u.top):g>u.bottom?(t.y=r-n-h?p(u.top+u.height-g):0,g=u.bottom):t.y=0;const _=m(d,y),b=m(f,g),S=v(d,y),x=v(f,g);s.x=_,s.y=b,s.width=S-_,s.height=x-b}B(){const{x:t,y:e,width:s,height:i}=this.h,{style:o}=this.S;o.left=`${t}px`,o.top=`${e}px`,o.width=`${s}px`,o.height=`${i}px`}C(t,e){const{document:s,features:o}=this._,{u:n}=this;r(s,["mousemove","touchmove"],this.M),r(s,["touchmove","mousemove"],this.F),r(s,["mouseup","touchcancel","touchend"],this.C),r(s,"scroll",this.k),t&&n&&o.singleTap.allow?this.O(t):n||e||(this.q(),this.j("stop",t)),this.v.x=0,this.v.y=0,this.p&&r(s,"wheel",this.$,{passive:!0}),this.A.remove(),i(this.S,"display","none"),this.U()}q(){const{o:t,_:e,i:s,h:i}=this,{stored:o,selected:n,touched:r}=s,{intersect:h,overlap:c}=e.behaviour,a=[],u=[],d=[];for(let e=0;e<t.length;e++){const s=t[e];if(l(i,s.getBoundingClientRect(),h)){if(n.includes(s))o.includes(s)&&!r.includes(s)&&r.push(s);else{if("invert"===c&&o.includes(s)){d.push(s);continue}u.push(s)}a.push(s)}}"invert"===c&&u.push(...o.filter((t=>!n.includes(t))));for(let t=0;t<n.length;t++){const e=n[t];a.includes(e)||"keep"===c&&o.includes(e)||d.push(e)}s.selected=a,s.changed={added:u,removed:d}}j(t,e){return this.emit(t,{event:e,store:this.i,selection:this})}U(){const{_:t,i:e}=this,{selected:s,changed:i,touched:o,stored:n}=e,r=s.filter((t=>!n.includes(t)));switch(t.behaviour.overlap){case"drop":e.stored=r.concat(n.filter((t=>!o.includes(t))));break;case"invert":e.stored=r.concat(n.filter((t=>!i.removed.includes(t))));break;case"keep":e.stored=n.concat(s.filter((t=>!n.includes(t))))}}trigger(t,e=!0){this.T(t,e)}resolveSelectables(){this.o=u(this._.selectables,this._.document)}clearSelection(t=!0){this.i={stored:t?[]:this.i.stored,selected:[],touched:[],changed:{added:[],removed:[]}}}getSelection(){return this.i.stored}getSelectionArea(){return this.S}cancel(t=!1){this.C(null,!t)}destroy(){this.cancel(),this.disable(),this.A.remove(),super.unbindAllListeners()}select(t,e=!1){const{changed:s,selected:i,stored:o}=this.i,n=u(t,this._.document).filter((t=>!i.includes(t)&&!o.includes(t)));return i.push(...n),s.added.push(...n),!e&&this.j("move",null),n}deselect(t,e=!1){const{selected:s,stored:i,changed:o}=this.i;return!(!s.includes(t)&&!i.includes(t))&&(o.removed.push(t),a(i,t),a(s,t),!e&&this.j("move",null),!0)}}SelectionArea.version="3.0.0-beta.7";var g=e.defineComponent({props:{onBeforeStart:{type:Function,default:void 0},onStart:{type:Function,default:void 0},onMove:{type:Function,default:void 0},onStop:{type:Function,default:void 0},options:{type:Object,default:()=>({})}},setup:()=>({instance:null}),mounted(){this.instance=new SelectionArea({boundaries:this.$refs.container,...this.options});const{onBeforeStart:t,onStart:e,onMove:s,onStop:i}=this;t&&this.instance.on("beforestart",t),e&&this.instance.on("start",e),s&&this.instance.on("move",s),i&&this.instance.on("stop",i)},beforeUnmount(){this.instance?.destroy()}});const _={ref:"container"};g.render=function(t,s,i,o,n,r){return e.openBlock(),e.createBlock("div",_,[e.renderSlot(t.$slots,"default")],512)},g.W="src/SelectionArea.vue",t.VanillaSelectionArea=SelectionArea,t.default=g,Object.defineProperty(t,"I",{value:!0})}));
//# sourceMappingURL=viselect.cjs.js.map
